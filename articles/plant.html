<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>plant: A package for modelling forest trait ecology &amp; evolution: <em>Plant-level properties</em> • plant</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">plant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/plant.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cohort_spacing.html">plant: A package for modelling forest trait ecology &amp; evolution: _Cohort spacing algorithm_</a>
    </li>
    <li>
      <a href="../articles/developer_notes.html">Developer Notes</a>
    </li>
    <li>
      <a href="../articles/emergent.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level emergent properties_</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">plant: A package for modelling forest trait ecology &amp; evolution: _Finding demographic equilibrium_</a>
    </li>
    <li>
      <a href="../articles/fitness.html">plant: A package for modelling forest trait ecology &amp; evolution: _Calculating fitness_</a>
    </li>
    <li>
      <a href="../articles/parameters.html">plant: A package for modelling forest trait ecology &amp; evolution: _Modifying parameters_</a>
    </li>
    <li>
      <a href="../articles/patch.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level dynamics_</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>plant: A package for modelling forest trait ecology &amp; evolution: <em>Plant-level properties</em>
</h1>
            
            <h4 class="date">2018-01-04</h4>
          </div>

    
    
<div class="contents">
<p>This vignette illustrates the sort of analysis used to generate the plant figure (Fig 2) in the manuscript, i.e. modelling the dynamics of individual plants. It also shows some of the features of working with plant components of the model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(plant)</a></code></pre></div>
<p>Plants are constructed with the <code>FF16_Plant</code> function. That function takes as its only argument a “strategy” object; the default is <code>FF16_Strategy</code>, but alternative strategies can be provided (see below). The “strategy” object contains all the physiological underpinning the dynamics of individual plants and entire metapopulations.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_Plant</a></span>()</a></code></pre></div>
<p>Plants are an <a href="https://github.com/wch/R6">R6</a> class, and have a number of elements and fields that can be accessed:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">pl</a></code></pre></div>
<pre><code>## &lt;Plant&lt;FF16&gt;&gt;
##   Inherits from: &lt;Plant&gt;
##   Public:
##     .ptr: externalptr
##     area_leaf_above: function (h) 
##     clone: function (deep = FALSE) 
##     compute_vars_phys: function (environment) 
##     fecundity: active binding
##     germination_probability: function (environment) 
##     height: active binding
##     initialize: function (ptr) 
##     internals: active binding
##     mortality: active binding
##     mortality_probability: active binding
##     ode_names: active binding
##     ode_rates: active binding
##     ode_size: active binding
##     ode_state: active binding
##     reset_mortality: function () 
##     strategy: active binding</code></pre>
<p>Things labelled ‘active binding’ are “fields” and can be read from and (sometimes) set:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">pl<span class="op">$</span>height</a></code></pre></div>
<pre><code>## [1] 0.3441948</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">pl<span class="op">$</span>height &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">pl<span class="op">$</span>height</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">pl<span class="op">$</span>fecundity</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">pl<span class="op">$</span>mortality</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Height, fecundity and mortality are the three key variables propagated by the internal system of differential equations:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">pl<span class="op">$</span>ode_state</a></code></pre></div>
<pre><code>## [1] 10  0  0  0  0</code></pre>
<p>To compute rates of change for these variables we need a light environment. The function <code>fixed_environment</code> creates an environment that has the same canopy openness (here 100%) at all heights. The plant <em>does not affect</em> this light environment.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(<span class="fl">1.0</span>)</a></code></pre></div>
<p>The <code>compute_vars_phys</code> method computes net mass production for the plant, and from that demographic rates:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">pl<span class="op">$</span>ode_rates</a></code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(env)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">pl<span class="op">$</span>ode_rates</a></code></pre></div>
<pre><code>## [1] 9.231625e-01 1.002618e-02 6.905594e-05 3.132290e-04 1.687620e+00</code></pre>
<p>Some internals from the calculations are available in the <code>internals</code> field:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">names</span>(pl<span class="op">$</span>internals)</a></code></pre></div>
<pre><code>##  [1] "area_leaf"         "height"            "height_dt"        
##  [4] "mortality"         "mortality_dt"      "fecundity"        
##  [7] "fecundity_dt"      "area_heartwood"    "area_heartwood_dt"
## [10] "mass_heartwood"    "mass_heartwood_dt"</code></pre>
<p>Height growth rate</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">pl<span class="op">$</span>internals<span class="op">$</span>height_dt</a></code></pre></div>
<pre><code>## [1] 0.9231625</code></pre>
<p>Leaf area (m^2)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">pl<span class="op">$</span>internals<span class="op">$</span>area_leaf</a></code></pre></div>
<pre><code>## [1] 7.312332</code></pre>
<p>There’s not actually that much that can be done with Plant objects; they’re designed to be small and light to work well with the larger simulation code that does not particularly care about most of the internal calculations.</p>
<p>Because of this, we have a “PlantPlus” object that exposes more of a strategy, and in addition stem diameter growth:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">pp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(pl<span class="op">$</span>strategy)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">pp<span class="op">$</span><span class="kw">compute_vars_phys</span>(env)</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw">names</span>(pp<span class="op">$</span>internals)</a></code></pre></div>
<pre><code>##  [1] "mass_leaf"                        "area_leaf"                       
##  [3] "height"                           "area_sapwood"                    
##  [5] "mass_sapwood"                     "area_bark"                       
##  [7] "mass_bark"                        "area_heartwood"                  
##  [9] "mass_heartwood"                   "area_stem"                       
## [11] "mass_root"                        "mass_live"                       
## [13] "mass_total"                       "mass_above_ground"               
## [15] "diameter_stem"                    "assimilation"                    
## [17] "respiration"                      "turnover"                        
## [19] "net_mass_production_dt"           "fraction_allocation_reproduction"
## [21] "fraction_allocation_growth"       "fecundity_dt"                    
## [23] "area_leaf_dt"                     "darea_leaf_dmass_live"           
## [25] "height_dt"                        "area_heartwood_dt"               
## [27] "mass_heartwood_dt"                "mortality_dt"                    
## [29] "mortality"                        "fecundity"                       
## [31] "dheight_darea_leaf"               "dmass_sapwood_darea_leaf"        
## [33] "dmass_bark_darea_leaf"            "dmass_root_darea_leaf"           
## [35] "area_sapwood_dt"                  "area_bark_dt"                    
## [37] "area_stem_dt"                     "ddiameter_stem_darea_stem"       
## [39] "diameter_stem_dt"                 "mass_root_dt"                    
## [41] "mass_live_dt"                     "mass_total_dt"                   
## [43] "mass_above_ground_dt"</code></pre>
<p>Some of the internals require <code>compute_vars_internals</code> to be run (the zapsmall function rounds numbers close to zero to zero):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">pp<span class="op">$</span><span class="kw">compute_vars_growth</span>()</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw">zapsmall</span>(<span class="kw">unlist</span>(pp<span class="op">$</span>internals))</a></code></pre></div>
<pre><code>##                        mass_leaf                        area_leaf 
##                            0.000                            0.000 
##                           height                     area_sapwood 
##                            0.344                            0.000 
##                     mass_sapwood                        area_bark 
##                            0.000                            0.000 
##                        mass_bark                   area_heartwood 
##                            0.000                            0.000 
##                   mass_heartwood                        area_stem 
##                            0.000                            0.000 
##                        mass_root                        mass_live 
##                            0.000                            0.000 
##                       mass_total                mass_above_ground 
##                            0.000                            0.000 
##                    diameter_stem                     assimilation 
##                            0.000                            0.015 
##                      respiration                         turnover 
##                            0.007                            0.000 
##           net_mass_production_dt fraction_allocation_reproduction 
##                            0.000                            0.000 
##       fraction_allocation_growth                     fecundity_dt 
##                            1.000                            0.000 
##                     area_leaf_dt            darea_leaf_dmass_live 
##                            0.000                            3.043 
##                        height_dt                area_heartwood_dt 
##                            0.334                            0.000 
##                mass_heartwood_dt                     mortality_dt 
##                            0.000                            0.010 
##                        mortality                        fecundity 
##                            0.000                            0.000 
##               dheight_darea_leaf         dmass_sapwood_darea_leaf 
##                          871.275                            0.052 
##            dmass_bark_darea_leaf            dmass_root_darea_leaf 
##                            0.009                            0.070 
##                  area_sapwood_dt                     area_bark_dt 
##                            0.000                            0.000 
##                     area_stem_dt        ddiameter_stem_darea_stem 
##                            0.000                         3241.596 
##                 diameter_stem_dt                     mass_root_dt 
##                            0.000                            0.000 
##                     mass_live_dt                    mass_total_dt 
##                            0.000                            0.000 
##             mass_above_ground_dt 
##                            0.000</code></pre>
<p>This PlantPlus object also includes heartwood area and mass as two more variables for the ODE system (this might move into Plant soon – see <a href="https://github.com/traitecoevo/plant/issues/139">this issue</a>). Tracking of these variables is needed to estimate stem diameter growth</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">pp<span class="op">$</span>ode_names</a></code></pre></div>
<pre><code>## [1] "height"         "mortality"      "fecundity"      "area_heartwood"
## [5] "mass_heartwood"</code></pre>
<p>Plants are a type of <em>reference object</em>. They are different to almost every other R object you regularly interact with in that they do not make copies when you rename them. So changes to one will be reflected in another.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">pl2 &lt;-<span class="st"> </span>pl</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">pl2<span class="op">$</span>height &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3">pl2<span class="op">$</span>height</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">pl<span class="op">$</span>height <span class="co"># also 1!</span></a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<section id="growing-plants" class="level1"><h1>Growing plants</h1>
<p>Rather than setting plant physical sizes to given values, it will often be required to <em>grow</em> them to a size. This is required to compute seed output (integrated over the plant’s lifetime) stem diameter, survival, etc; basically everything except for height.</p>
<p>It’s possible to directly integrate the equations exposed by the plant, using the <code>ode_state</code> field, <code>compute_vars_phys</code> method and <code>ode_rates</code> field. For example, we can use the R package <code>deSolve</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">derivs &lt;-<span class="st"> </span><span class="cf">function</span>(t, y, plant, env) {</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  plant<span class="op">$</span>ode_state &lt;-<span class="st"> </span>y</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">  plant<span class="op">$</span><span class="kw">compute_vars_phys</span>(env)</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  <span class="kw">list</span>(plant<span class="op">$</span>ode_rates)</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_Plant</a></span>()</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">tt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dt">length.out=</span><span class="dv">101</span>)</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">y0 &lt;-<span class="st"> </span><span class="kw">setNames</span>(pl<span class="op">$</span>ode_state, pl<span class="op">$</span>ode_names)</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">yy &lt;-<span class="st"> </span>deSolve<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/deSolve/topics/lsoda">lsoda</a></span>(y0, tt, derivs, pl, <span class="dt">env=</span>env)</a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="kw">plot</span>(height <span class="op">~</span><span class="st"> </span>time, yy, <span class="dt">type=</span><span class="st">"l"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-15-1.png"></p>
<p>Alternatively, it might desirable to grow a plant to a particular size. We could interpolate from the previous results easily enough. E.g., to find a plant with height of 15 m:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">h &lt;-<span class="st"> </span><span class="fl">15.0</span></a></code></pre></div>
<p>that happened approximately here:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">t &lt;-<span class="st"> </span><span class="kw">spline</span>(yy[, <span class="st">"height"</span>], yy[, <span class="st">"time"</span>], <span class="dt">xout=</span>h)<span class="op">$</span>y</a></code></pre></div>
<p>Interpolate to find the state:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">apply</span>(yy[, <span class="dv">-1</span>], <span class="dv">2</span>, <span class="cf">function</span>(y) <span class="kw">spline</span>(yy[, <span class="st">"time"</span>], y, <span class="dt">xout=</span>t)<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"></a>
<a class="sourceLine" id="cb39-3" data-line-number="3">pl2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_Plant</a></span>()</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">pl2<span class="op">$</span>ode_state &lt;-<span class="st"> </span>y</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">pl2<span class="op">$</span><span class="kw">compute_vars_phys</span>(env)</a></code></pre></div>
<p>Plant is expected height:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">pl2<span class="op">$</span>height</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p>And at this height, here is the total seed production:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">pl2<span class="op">$</span>fecundity</a></code></pre></div>
<pre><code>## [1] 289.9376</code></pre>
<p>To make this type of operation easier, we provide the function <code>grow_plant_to_time</code></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_time.html">grow_plant_to_time</a></span>(<span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(<span class="kw"><a href="../reference/FF16_Strategy.html">FF16_Strategy</a></span>()), tt, env)</a></code></pre></div>
<p>Here is the result, plotted against the result obtained from using <code>deSolve</code> above:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">plot</span>(height <span class="op">~</span><span class="st"> </span>tt, res<span class="op">$</span>state, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">las=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">     <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw">points</span>(height <span class="op">~</span><span class="st"> </span>time, yy, <span class="dt">col=</span><span class="st">"grey"</span>, <span class="dt">cex=</span>.<span class="dv">5</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-22-1.png"></p>
<p>Completing the set, <code>plant</code> also provides a function for growing plants to a particular size; <code>grow_plant_to_size</code>. This takes <em>any</em> size measurement in the plant and can grow the plant to that size. So, for height:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(<span class="kw"><a href="../reference/FF16_Strategy.html">FF16_Strategy</a></span>())</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">heights &lt;-<span class="st"> </span><span class="kw">seq</span>(pl<span class="op">$</span>height, pl<span class="op">$</span>strategy<span class="op">$</span>hmat, <span class="dt">length.out=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_size</a></span>(pl, heights, <span class="st">"height"</span>, env)</a></code></pre></div>
<p>This returns a vector of times; this is when the heights were achieved</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">res<span class="op">$</span>time</a></code></pre></div>
<pre><code>##  [1]  0.000000  1.545681  2.523393  3.365033  4.155087  4.926508  5.696593
##  [8]  6.476387  7.274127  8.096757  8.950785  9.842785 10.779771 11.769706
## [15] 12.821689 13.946774 15.158668 16.476692 17.957500 20.137320</code></pre>
<p>A matrix of state:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">head</span>(res<span class="op">$</span>state)</a></code></pre></div>
<pre><code>##         height  mortality    fecundity area_heartwood mass_heartwood
## [1,] 0.3441948 0.00000000 0.000000e+00   0.000000e+00   0.000000e+00
## [2,] 1.1995465 0.01545682 7.754892e-20   1.280271e-07   6.544158e-05
## [3,] 2.0548958 0.02523396 5.654011e-18   9.826616e-07   8.617440e-04
## [4,] 2.9102485 0.03365038 2.252986e-16   3.837305e-06   4.790943e-03
## [5,] 3.7656006 0.04155098 6.750246e-15   1.081677e-05   1.755419e-02
## [6,] 4.6209512 0.04926531 1.710259e-13   2.510437e-05   5.019027e-02</code></pre>
<p>And a list of plants</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">res<span class="op">$</span>plant[[<span class="dv">10</span>]]</a></code></pre></div>
<pre><code>## &lt;PlantPlus&lt;FF16&gt;&gt;
##   Inherits from: &lt;PlantPlus&gt;
##   Public:
##     .ptr: externalptr
##     area_heartwood: active binding
##     area_leaf: active binding
##     area_leaf_above: function (h) 
##     clone: function (deep = FALSE) 
##     compute_vars_growth: function () 
##     compute_vars_phys: function (environment) 
##     fecundity: active binding
##     germination_probability: function (environment) 
##     height: active binding
##     initialize: function (ptr) 
##     internals: active binding
##     mass_heartwood: active binding
##     mortality: active binding
##     ode_names: active binding
##     ode_rates: active binding
##     ode_size: active binding
##     ode_state: active binding
##     strategy: active binding
##     to_plant: function ()</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">res<span class="op">$</span>plant[[<span class="dv">10</span>]]<span class="op">$</span>height</a></code></pre></div>
<pre><code>## [1] 8.042356</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">heights[[<span class="dv">10</span>]]</a></code></pre></div>
<pre><code>## [1] 8.042356</code></pre>
<p>Also included is <code>trajectory</code>; the points that the ODE stepper used with the system state at those times.</p>
<p>There is a convenience function <code>run_plant_to_heights</code> that achieves the same thing. Alternatively, and variable within <code>plant$internals</code> can be used, so long as it increases monotonically with respect to time.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(<span class="kw"><a href="../reference/FF16_Strategy.html">FF16_Strategy</a></span>())</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">mass &lt;-<span class="st"> </span><span class="kw"><a href="../reference/seq_log.html">seq_log</a></span>(pl<span class="op">$</span>internals<span class="op">$</span>mass_above_ground <span class="op">+</span><span class="st"> </span><span class="fl">1e-8</span>, <span class="dv">1000</span>, <span class="dt">length.out=</span><span class="dv">21</span>)</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">res_mass &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_size</a></span>(pl, mass, <span class="st">"mass_above_ground"</span>, env,</a>
<a class="sourceLine" id="cb57-4" data-line-number="4">                               <span class="dt">time_max=</span><span class="dv">100</span>, <span class="dt">warn=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>(this seems on the low side - see <a href="https://github.com/traitecoevo/plant/issues/142">this issue</a>).</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">plot</span>(res_mass<span class="op">$</span>time, mass, <span class="dt">type=</span><span class="st">"o"</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-28-1.png"></p>
<p>With all these bits in place, let’s look at growth trajectories of two species that differ in their LMA values. This what is presented In Fig. 2a of the paper.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/scm_base_parameters.html">scm_base_parameters</a></span>(<span class="st">"FF16"</span>)</a></code></pre></div>
<p>Low LMA (“fast growth”) species</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">s1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/strategy_list.html">strategy</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(<span class="fl">0.0825</span>,  <span class="st">"lma"</span>), p)</a></code></pre></div>
<p>High LMA (“low growth”) species</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">s2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/strategy_list.html">strategy</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(<span class="fl">0.2625</span>, <span class="st">"lma"</span>), p)</a></code></pre></div>
<p>Note that we’re using an alternative way of specifying strategies here, to trigger our “hyper-parametrisation” approach. This may be simplified in future, but currently the “hyper-parametrisation” function resides on the <code>p</code> object.</p>
<p>Then, generate a sequence of heights to collect information at</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">pl1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s1)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">pl2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s2)</a></code></pre></div>
<p>(they are different for the two plants because they have different starting heights, the lower LMA of s1 allows it to achieve a greater initial height for given seed mass)</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">heights1 &lt;-<span class="st"> </span><span class="kw">seq</span>(pl1<span class="op">$</span>height, s1<span class="op">$</span>hmat, <span class="dt">length.out=</span>100L)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2">heights2 &lt;-<span class="st"> </span><span class="kw">seq</span>(pl2<span class="op">$</span>height, s2<span class="op">$</span>hmat, <span class="dt">length.out=</span>100L)</a>
<a class="sourceLine" id="cb63-3" data-line-number="3"></a>
<a class="sourceLine" id="cb63-4" data-line-number="4">dat1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span>(pl1, heights1, env,</a>
<a class="sourceLine" id="cb63-5" data-line-number="5">                             <span class="dt">time_max=</span><span class="dv">100</span>, <span class="dt">warn=</span><span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb63-6" data-line-number="6">dat2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span>(pl2, heights2, env,</a>
<a class="sourceLine" id="cb63-7" data-line-number="7">                             <span class="dt">time_max=</span><span class="dv">100</span>, <span class="dt">warn=</span><span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb63-8" data-line-number="8"></a>
<a class="sourceLine" id="cb63-9" data-line-number="9"><span class="kw">plot</span>(dat1<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat1<span class="op">$</span>trajectory[, <span class="st">"height"</span>],</a>
<a class="sourceLine" id="cb63-10" data-line-number="10">     <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb63-11" data-line-number="11">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb63-12" data-line-number="12"><span class="kw">lines</span>(dat2<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat2<span class="op">$</span>trajectory[, <span class="st">"height"</span>], <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb63-13" data-line-number="13"><span class="kw">legend</span>(<span class="st">"bottomright"</span>, <span class="kw">c</span>(<span class="st">"Low LMA"</span>, <span class="st">"High LMA"</span>), <span class="dt">lty=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-33-1.png"></p>
<p>Similarly, growing the plants under lower light:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">env_low &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">dat1_low &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span>(pl1, heights1, env_low,</a>
<a class="sourceLine" id="cb64-3" data-line-number="3">                                 <span class="dt">time_max=</span><span class="dv">100</span>, <span class="dt">warn=</span><span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb64-4" data-line-number="4">dat2_low &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grow_plant_to_size.html">grow_plant_to_height</a></span>(pl2, heights2, env_low,</a>
<a class="sourceLine" id="cb64-5" data-line-number="5">                                 <span class="dt">time_max=</span><span class="dv">100</span>, <span class="dt">warn=</span><span class="ot">FALSE</span>, <span class="dt">filter=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb64-6" data-line-number="6"></a>
<a class="sourceLine" id="cb64-7" data-line-number="7">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"black"</span>, <span class="st">"#e34a33"</span>)</a>
<a class="sourceLine" id="cb64-8" data-line-number="8"><span class="kw">plot</span>(dat1<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat1<span class="op">$</span>trajectory[, <span class="st">"height"</span>],</a>
<a class="sourceLine" id="cb64-9" data-line-number="9">     <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb64-10" data-line-number="10">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb64-11" data-line-number="11"><span class="kw">lines</span>(dat2<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat2<span class="op">$</span>trajectory[, <span class="st">"height"</span>], <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb64-12" data-line-number="12"><span class="kw">lines</span>(dat1_low<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat1_low<span class="op">$</span>trajectory[, <span class="st">"height"</span>],</a>
<a class="sourceLine" id="cb64-13" data-line-number="13">      <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb64-14" data-line-number="14"><span class="kw">lines</span>(dat2_low<span class="op">$</span>trajectory[, <span class="st">"time"</span>], dat2_low<span class="op">$</span>trajectory[, <span class="st">"height"</span>],</a>
<a class="sourceLine" id="cb64-15" data-line-number="15">      <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb64-16" data-line-number="16"><span class="kw">legend</span>(<span class="st">"bottomright"</span>,</a>
<a class="sourceLine" id="cb64-17" data-line-number="17">       <span class="kw">c</span>(<span class="st">"High light"</span>, <span class="st">"Low light"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols,</a>
<a class="sourceLine" id="cb64-18" data-line-number="18">       <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-34-1.png"></p>
<p>The <em>height growth rate</em> is the derivative of height with respect to time - the slope of the plot above. It is really the core quantity in the model; the actual heights are computed by solving the set of ODEs that includes height growth rate.</p>
<p>Growth rate with respect to height shows a hump-shaped pattern that is affected by both traits and by light environment. To extract this information from the trajectories takes a little more work though.</p>
<p>Here is a plant from part way through one run</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">pl &lt;-<span class="st"> </span>dat1<span class="op">$</span>plant[[<span class="dv">50</span>]]</a></code></pre></div>
<p>Here is the set of ODE state variables:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">setNames</span>(pl<span class="op">$</span>ode_state, pl<span class="op">$</span>ode_names)</a></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   8.412120e+00   7.797210e-02   9.998839e-08   3.403727e-04   1.262008e+00</code></pre>
<p>And the set of <em>rate</em> variables</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw">setNames</span>(pl<span class="op">$</span>ode_rates, pl<span class="op">$</span>ode_names)</a></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   9.530474e-01   1.003019e-02   3.243850e-07   1.780143e-04   8.068135e-01</code></pre>
<p>…however, the rates might not be correct. They are whatever was left by the ODE stepper when it was advancing the plant, so it’s best to update them:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(dat1<span class="op">$</span>env)</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="kw">setNames</span>(pl<span class="op">$</span>ode_rates, pl<span class="op">$</span>ode_names)</a></code></pre></div>
<pre><code>##         height      mortality      fecundity area_heartwood mass_heartwood 
##   9.530474e-01   1.003019e-02   3.243850e-07   1.780143e-04   8.068135e-01</code></pre>
<p>(in this case they are the same because the light environment is unchanging, but that not be the case generally)</p>
<p>Alternatively, we can access the height growth rate via the internals, which is the same as accessing directly from the ODE rates but more explicit:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">pl<span class="op">$</span>internals<span class="op">$</span>height_dt</a></code></pre></div>
<pre><code>## [1] 0.9530474</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">pl<span class="op">$</span>ode_rates[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] 0.9530474</code></pre>
<p>Collecting height growth for all plants:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">dhdt1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(dat1<span class="op">$</span>plant, <span class="cf">function</span>(x) x<span class="op">$</span>internals<span class="op">$</span>height_dt)</a>
<a class="sourceLine" id="cb76-2" data-line-number="2">dhdt2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(dat2<span class="op">$</span>plant, <span class="cf">function</span>(x) x<span class="op">$</span>internals<span class="op">$</span>height_dt)</a>
<a class="sourceLine" id="cb76-3" data-line-number="3">dhdt1_low &lt;-<span class="st"> </span><span class="kw">sapply</span>(dat1_low<span class="op">$</span>plant, <span class="cf">function</span>(x) x<span class="op">$</span>internals<span class="op">$</span>height_dt)</a>
<a class="sourceLine" id="cb76-4" data-line-number="4">dhdt2_low &lt;-<span class="st"> </span><span class="kw">sapply</span>(dat2_low<span class="op">$</span>plant, <span class="cf">function</span>(x) x<span class="op">$</span>internals<span class="op">$</span>height_dt)</a>
<a class="sourceLine" id="cb76-5" data-line-number="5"></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"><span class="kw">plot</span>(dat1<span class="op">$</span>time, dhdt1, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb76-7" data-line-number="7">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height growth rate (m / yr)"</span>)</a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="kw">lines</span>(dat2<span class="op">$</span>time, dhdt2, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="kw">lines</span>(dat1_low<span class="op">$</span>time, dhdt1_low, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="kw">lines</span>(dat2_low<span class="op">$</span>time, dhdt2_low, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="kw">legend</span>(<span class="st">"topright"</span>,</a>
<a class="sourceLine" id="cb76-12" data-line-number="12">       <span class="kw">c</span>(<span class="st">"High light"</span>, <span class="st">"Low light"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols,</a>
<a class="sourceLine" id="cb76-13" data-line-number="13">       <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-40-1.png"></p>
<p>Alternatively, change in height plotted against height itself:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">ylim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(dhdt1))</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="kw">plot</span>(dat1<span class="op">$</span>state[, <span class="st">"height"</span>], dhdt1, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">lty=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb77-3" data-line-number="3">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Height (m)"</span>, <span class="dt">ylab=</span><span class="st">"Height growth rate (m / yr)"</span>, <span class="dt">ylim=</span>ylim)</a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw">lines</span>(dat2<span class="op">$</span>state[, <span class="st">"height"</span>], dhdt2, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="kw">lines</span>(dat1_low<span class="op">$</span>state[, <span class="st">"height"</span>], dhdt1_low, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="kw">lines</span>(dat2_low<span class="op">$</span>state[, <span class="st">"height"</span>], dhdt2_low, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="kw">legend</span>(<span class="st">"topright"</span>,</a>
<a class="sourceLine" id="cb77-8" data-line-number="8">       <span class="kw">c</span>(<span class="st">"High light"</span>, <span class="st">"Low light"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols,</a>
<a class="sourceLine" id="cb77-9" data-line-number="9">       <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-41-1.png"></p>
<p>Over a plant’s life, allocation to different structures varies. This is captured by a set of variables stored within the internals: e.g., <code>mass_leaf</code> <code>mass_sapwood</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">pl<span class="op">$</span>internals<span class="op">$</span>mass_leaf</a></code></pre></div>
<pre><code>## [1] 0.3428489</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">pl<span class="op">$</span>internals<span class="op">$</span>mass_sapwood</a></code></pre></div>
<pre><code>## [1] 4.034067</code></pre>
<p>(these numbers seem a bit off: one of the motivations here is to develop and use better models of plant allometry. The parameterisation used at present are derived from adults and perform poorly with small plants. However, based on height / area relationships [Falster 2011, supporting information], for an 8m tall plant total leaf areas of 5-10 m are plausible and with an LMA of 0.08 that implies a total <em>dry</em> weight of 400 - 800 g).</p>
<p>Total live dry mass fraction to leaf and stem can be computed as:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(p) {</a>
<a class="sourceLine" id="cb82-2" data-line-number="2">  p_ints &lt;-<span class="st"> </span>p<span class="op">$</span>internals</a>
<a class="sourceLine" id="cb82-3" data-line-number="3">  <span class="kw">c</span>(<span class="dt">leaf=</span>p_ints<span class="op">$</span>mass_leaf <span class="op">/</span><span class="st"> </span>p_ints<span class="op">$</span>mass_live,</a>
<a class="sourceLine" id="cb82-4" data-line-number="4">    <span class="dt">sapwood=</span>p_ints<span class="op">$</span>mass_sapwood <span class="op">/</span><span class="st"> </span>p_ints<span class="op">$</span>mass_live)</a>
<a class="sourceLine" id="cb82-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb82-6" data-line-number="6"></a>
<a class="sourceLine" id="cb82-7" data-line-number="7">cols_part &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"black"</span>, <span class="st">"#045a8d"</span>)</a>
<a class="sourceLine" id="cb82-8" data-line-number="8"><span class="kw">matplot</span>(dat1<span class="op">$</span>state[, <span class="st">"height"</span>], <span class="kw">t</span>(<span class="kw">sapply</span>(dat1<span class="op">$</span>plant, f)),</a>
<a class="sourceLine" id="cb82-9" data-line-number="9">        <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">col=</span>cols_part, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb82-10" data-line-number="10">        <span class="dt">xlab=</span><span class="st">"Height (m)"</span>, <span class="dt">ylab=</span><span class="st">"Fractional allocation"</span>, <span class="dt">las=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb82-11" data-line-number="11"><span class="kw">matlines</span>(dat2<span class="op">$</span>state[, <span class="st">"height"</span>], <span class="kw">t</span>(<span class="kw">sapply</span>(dat2<span class="op">$</span>plant, f)),</a>
<a class="sourceLine" id="cb82-12" data-line-number="12">         <span class="dt">col=</span>cols_part, <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb82-13" data-line-number="13"><span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="kw">c</span>(<span class="st">"Sapwood"</span>, <span class="st">"Leaf"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw">rev</span>(cols_part), <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-43-1.png"></p>
<p>Relative allocation to leaf mass drops steeply as a plant grows and is replaced by allocation to sapwood mass.</p>
<p>The growth rates vary with both size and light environment (see above).</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">pl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>()</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">pl<span class="op">$</span>height &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3">pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(<span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(<span class="fl">1.0</span>))</a>
<a class="sourceLine" id="cb83-4" data-line-number="4">pl<span class="op">$</span>internals<span class="op">$</span>height_dt <span class="co"># in full light</span></a></code></pre></div>
<pre><code>## [1] 0.9231625</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(<span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">pl<span class="op">$</span>internals<span class="op">$</span>height_dt <span class="co"># in 1/2 light</span></a></code></pre></div>
<pre><code>## [1] 0.4522332</code></pre>
<p>At some point the plant cannot maintain positive carbon balance and therefore cannot grow; for example at 25% canopy openness:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(<span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(<span class="fl">0.25</span>))</a>
<a class="sourceLine" id="cb87-2" data-line-number="2">pl<span class="op">$</span>internals<span class="op">$</span>height_dt</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>The light level at which carbon gain becomes zero is the “whole plant light compensation point”.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw"><a href="../reference/lcp_whole_plant.html">lcp_whole_plant</a></span>(pl)</a></code></pre></div>
<pre><code>## [1] 0.2991714</code></pre>
<p>Consider a vector of canopy opennesses:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">openness &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out=</span><span class="dv">51</span>)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"></a>
<a class="sourceLine" id="cb91-3" data-line-number="3">lcp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/lcp_whole_plant.html">lcp_whole_plant</a></span>(pl)</a></code></pre></div>
<p>Height growth rate increases in a saturating fashion with increasing canopy openness from the light compensation point.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x, pl) {</a>
<a class="sourceLine" id="cb92-2" data-line-number="2">  env &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fixed_environment.html">fixed_environment</a></span>(x)</a>
<a class="sourceLine" id="cb92-3" data-line-number="3">  pl<span class="op">$</span><span class="kw">compute_vars_phys</span>(env)</a>
<a class="sourceLine" id="cb92-4" data-line-number="4">  pl<span class="op">$</span>internals<span class="op">$</span>height_dt</a>
<a class="sourceLine" id="cb92-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb92-6" data-line-number="6">x &lt;-<span class="st"> </span><span class="kw">c</span>(lcp, openness[openness <span class="op">&gt;</span><span class="st"> </span>lcp])</a>
<a class="sourceLine" id="cb92-7" data-line-number="7"><span class="kw">plot</span>(x, <span class="kw">sapply</span>(x, f, pl), <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb92-8" data-line-number="8">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Canopy openness"</span>, <span class="dt">ylab=</span><span class="st">"Height growth rate (m / yr)"</span>)</a>
<a class="sourceLine" id="cb92-9" data-line-number="9"><span class="kw">points</span>(lcp, <span class="fl">0.0</span>, <span class="dt">pch=</span><span class="dv">19</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-48-1.png"></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">g &lt;-<span class="st"> </span><span class="cf">function</span>(x, pl) {</a>
<a class="sourceLine" id="cb93-2" data-line-number="2">  lcp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/lcp_whole_plant.html">lcp_whole_plant</a></span>(pl)</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">c</span>(lcp, openness[openness <span class="op">&gt;</span><span class="st"> </span>lcp])</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">  <span class="kw">cbind</span>(<span class="dt">x=</span>x, <span class="dt">y=</span><span class="kw">sapply</span>(x, f, pl))</a>
<a class="sourceLine" id="cb93-5" data-line-number="5">}</a></code></pre></div>
<p>Now, consider this for a seedling and for a plant at half its maximum size size:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">pl_seed &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s1)</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">y_seed &lt;-<span class="st"> </span><span class="kw">g</span>(openness, pl_seed)</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">pl_adult &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s1)</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">pl_adult<span class="op">$</span>height &lt;-<span class="st"> </span>pl_adult<span class="op">$</span>strategy<span class="op">$</span>hmat <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb94-5" data-line-number="5">y_adult &lt;-<span class="st"> </span><span class="kw">g</span>(openness, pl_adult)</a>
<a class="sourceLine" id="cb94-6" data-line-number="6">cols_height &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#31a354"</span>, <span class="st">"black"</span>)</a>
<a class="sourceLine" id="cb94-7" data-line-number="7"></a>
<a class="sourceLine" id="cb94-8" data-line-number="8">ymax &lt;-<span class="st"> </span><span class="kw">max</span>(y_seed[, <span class="dv">2</span>], y_adult[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb94-9" data-line-number="9"><span class="kw">plot</span>(y_seed, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">col=</span>cols_height[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb94-10" data-line-number="10">     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, ymax), <span class="dt">las=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb94-11" data-line-number="11">     <span class="dt">xlab=</span><span class="st">"Canopy openness"</span>, <span class="dt">ylab=</span><span class="st">"Height growth year (m / yr)"</span>)</a>
<a class="sourceLine" id="cb94-12" data-line-number="12"><span class="kw">lines</span>(y_adult, <span class="dt">col=</span>cols_height[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb94-13" data-line-number="13"><span class="kw">legend</span>(<span class="st">"bottomright"</span>, <span class="kw">c</span>(<span class="st">"Seedling"</span>, <span class="st">"Adult"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols_height, <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-49-1.png"></p>
<p>The light compensation point and curve varies with traits, too:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">pl2_seed &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s2)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2">pl2_adult &lt;-<span class="st"> </span><span class="kw"><a href="../reference/FF16.html">FF16_PlantPlus</a></span>(s2)</a>
<a class="sourceLine" id="cb95-3" data-line-number="3">pl2_adult<span class="op">$</span>height &lt;-<span class="st"> </span>pl2_adult<span class="op">$</span>strategy<span class="op">$</span>hmat <span class="op">/</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4">y2_seed &lt;-<span class="st"> </span><span class="kw">g</span>(openness, pl2_seed)</a>
<a class="sourceLine" id="cb95-5" data-line-number="5">y2_adult &lt;-<span class="st"> </span><span class="kw">g</span>(openness, pl2_adult)</a>
<a class="sourceLine" id="cb95-6" data-line-number="6"></a>
<a class="sourceLine" id="cb95-7" data-line-number="7">ymax &lt;-<span class="st"> </span><span class="kw">max</span>(ymax, y2_seed[, <span class="dv">2</span>], y2_adult[, <span class="dv">2</span>])</a>
<a class="sourceLine" id="cb95-8" data-line-number="8"><span class="kw">plot</span>(y_seed, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">col=</span>cols_height[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb95-9" data-line-number="9">     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, ymax), <span class="dt">las=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb95-10" data-line-number="10">     <span class="dt">xlab=</span><span class="st">"Canopy openness"</span>, <span class="dt">ylab=</span><span class="st">"Height growth year (m / yr)"</span>)</a>
<a class="sourceLine" id="cb95-11" data-line-number="11"><span class="kw">lines</span>(y_adult, <span class="dt">col=</span>cols_height[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb95-12" data-line-number="12"><span class="kw">lines</span>(y2_seed, <span class="dt">col=</span>cols_height[[<span class="dv">1</span>]], <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb95-13" data-line-number="13"><span class="kw">lines</span>(y2_adult, <span class="dt">col=</span>cols_height[[<span class="dv">2</span>]], <span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb95-14" data-line-number="14"><span class="kw">legend</span>(<span class="st">"bottomright"</span>, <span class="kw">c</span>(<span class="st">"Seedling"</span>, <span class="st">"Adult"</span>), <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span>cols_height, <span class="dt">bty=</span><span class="st">"n"</span>)</a></code></pre></div>
<p><img src="figure/plant__unnamed-chunk-50-1.png"></p>
<p>Note that the traits with the lowest growth rate in most lights while a seedling (dotted lines) has the highest growth rate in all lights as an adult.</p>
</section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#growing-plants">Growing plants</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
