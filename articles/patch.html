<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>plant: A package for modelling forest trait ecology &amp; evolution: <em>Patch-level dynamics</em> • plant</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">plant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/plant.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cohort_spacing.html">plant: A package for modelling forest trait ecology &amp; evolution: _Cohort spacing algorithm_</a>
    </li>
    <li>
      <a href="../articles/developer_notes.html">Developer Notes</a>
    </li>
    <li>
      <a href="../articles/emergent.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level emergent properties_</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">plant: A package for modelling forest trait ecology &amp; evolution: _Finding demographic equilibrium_</a>
    </li>
    <li>
      <a href="../articles/fitness.html">plant: A package for modelling forest trait ecology &amp; evolution: _Calculating fitness_</a>
    </li>
    <li>
      <a href="../articles/parameters.html">plant: A package for modelling forest trait ecology &amp; evolution: _Modifying parameters_</a>
    </li>
    <li>
      <a href="../articles/patch.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level dynamics_</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>plant: A package for modelling forest trait ecology &amp; evolution: <em>Patch-level dynamics</em>
</h1>
            
            <h4 class="date">2018-01-04</h4>
          </div>

    
    
<div class="contents">
<p>The aim here is to use plant to investigate dynamics of plants within a single patch.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(plant)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">p0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/scm_base_parameters.html">scm_base_parameters</a></span>(<span class="st">"FF16"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">p0<span class="op">$</span>control<span class="op">$</span>equilibrium_nsteps &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">p0<span class="op">$</span>control<span class="op">$</span>equilibrium_solver_name &lt;-<span class="st"> "hybrid"</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">p0<span class="op">$</span>disturbance_mean_interval &lt;-<span class="st"> </span><span class="fl">30.0</span></a></code></pre></div>
<p>First, with a single species:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">p1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_parameters.html">expand_parameters</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(<span class="fl">0.0825</span>, <span class="st">"lma"</span>), p0, <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Run everything out to equilibrium:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">p1_eq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equilibrium_seed_rain.html">equilibrium_seed_rain</a></span>(p1)</a></code></pre></div>
<p>This collects information about the state of the system at every ODE step:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">data1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_scm_collect.html">run_scm_collect</a></span>(p1_eq)</a></code></pre></div>
<p>Entries are: * time: time of the step * species: a list with the state of each species (in this case there is only 1). The contents is a 3d array of variable / time step / cohort * light_env: a list with the points of the light environment spline (height / canopy openness) * seed_rain: output seed rain * p: input parameters</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">names</span>(data1)</a></code></pre></div>
<pre><code>## [1] "time"          "species"       "light_env"     "seed_rain"    
## [5] "patch_density" "p"</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">t &lt;-<span class="st"> </span>data1<span class="op">$</span>time</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">h &lt;-<span class="st"> </span>data1<span class="op">$</span>species[[<span class="dv">1</span>]][<span class="st">"height"</span>, , ]</a></code></pre></div>
<p>h here is two of the three dimensions of the state array; each row is a <em>time</em> and each column is a <em>cohort</em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">dim</span>(h)</a></code></pre></div>
<pre><code>## [1] 214 213</code></pre>
<p>So the ith row is the height of all extant cohorts in the patch (some are NA if they have not been introduced yet)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">h[<span class="dv">150</span>, ]</a></code></pre></div>
<pre><code>##   [1] 10.2485992 10.2482823 10.2479654 10.2476483 10.2473311 10.2470138
##   [7] 10.2466964 10.2463789 10.2460613 10.2455764 10.2450913 10.2446059
##  [13] 10.2441202 10.2436342 10.2426616 10.2416879 10.2407131 10.2397372
##  [19] 10.2387603 10.2368034 10.2348421 10.2328766 10.2309067 10.2289326
##  [25] 10.2249714 10.2209928 10.2169967 10.2129830 10.2089516 10.2008353
##  [31] 10.1926469 10.1843857 10.1760509 10.1676416 10.1505967 10.1332448
##  [37] 10.1155797 10.0975952 10.0792849 10.0416630 10.0026648  9.9622402
##  [43]  9.9203426  9.8769319  9.8319750  9.7854454  9.6875796  9.5831993
##  [49]  9.4723566  9.4145938  9.3553453  9.2327455  9.1052512  8.9738718
##  [55]  8.8398917  8.5692273  8.4351001  8.3032636  8.1746287  8.0498992
##  [61]  7.8137910  7.5964892  7.3977024  7.2192089  7.0605443  6.9167563
##  [67]  6.7854018  6.6646825  6.5531909  6.4498147  6.2636984  6.1004274
##  [73]  5.9552741  5.8884229  5.8249981  5.6000828  5.5017418  5.4108713
##  [79]  5.3265873  5.2481566  5.1063563  4.9809935  4.8688142  4.7675043
##  [85]  4.6753646  4.5909377  4.4411792  4.3741009  4.3113747  4.1968742
##  [91]  4.0949065  4.0029292  3.9194395  3.7720448  3.6447932  3.5323634
##  [97]  3.4312027  3.3391155  3.1766769  3.0338193  2.9044425  2.7851320
## [103]  2.5713541  2.3754702  2.1919526  2.0198052  1.8596988  1.7156674
## [109]  1.5933398  1.4982955  1.4345562  1.4026839  1.3963969  1.3929998
## [115]  1.3863269  1.3819468  1.3769108  1.3713405  1.3653471  1.3589821
## [121]  1.3556643  1.3522573  1.3451835  1.3377756  1.3300350  1.3219608
## [127]  1.3135696  1.3048491  1.2957666  1.2863015  1.2764493  1.2662086
## [133]  1.2555801  1.2445605  1.2331284  1.2212655  1.2089375  1.1961458
## [139]  1.1692843  1.1408658  1.1108472  1.0790846  1.0111509  0.9381607
## [145]  0.8610027  0.7810595  0.6190055  0.5394430  0.4631125  0.3920458
## [151]         NA         NA         NA         NA         NA         NA
## [157]         NA         NA         NA         NA         NA         NA
## [163]         NA         NA         NA         NA         NA         NA
## [169]         NA         NA         NA         NA         NA         NA
## [175]         NA         NA         NA         NA         NA         NA
## [181]         NA         NA         NA         NA         NA         NA
## [187]         NA         NA         NA         NA         NA         NA
## [193]         NA         NA         NA         NA         NA         NA
## [199]         NA         NA         NA         NA         NA         NA
## [205]         NA         NA         NA         NA         NA         NA
## [211]         NA         NA         NA</code></pre>
<p>And the jth column is the heights of a particular cohort, NA if that time is before it was introduced:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">h[, <span class="dv">60</span>]</a></code></pre></div>
<pre><code>##   [1]         NA         NA         NA         NA         NA         NA
##   [7]         NA         NA         NA         NA         NA         NA
##  [13]         NA         NA         NA         NA         NA         NA
##  [19]         NA         NA         NA         NA         NA         NA
##  [25]         NA         NA         NA         NA         NA         NA
##  [31]         NA         NA         NA         NA         NA         NA
##  [37]         NA         NA         NA         NA         NA         NA
##  [43]         NA         NA         NA         NA         NA         NA
##  [49]         NA         NA         NA         NA         NA         NA
##  [55]         NA         NA         NA         NA         NA  0.3920458
##  [61]  0.3940845  0.3961303  0.3981832  0.4002432  0.4023102  0.4043843
##  [67]  0.4064655  0.4085537  0.4106491  0.4127515  0.4169774  0.4212316
##  [73]  0.4255141  0.4276659  0.4298247  0.4385306  0.4429258  0.4473490
##  [79]  0.4518004  0.4562798  0.4653227  0.4744774  0.4837435  0.4931208
##  [85]  0.5026088  0.5122071  0.5317328  0.5416593  0.5516942  0.5720869
##  [91]  0.5929062  0.6141470  0.6358040  0.6803435  0.7264755  0.7741473
##  [97]  0.8233033  0.8738852  0.9790879  1.0892687  1.2039391  1.3226190
## [103]  1.5701667  1.8284238  2.0942049  2.3645807  2.6368113  2.9083260
## [109]  3.1767522  3.4400192  3.6964981  3.9451054  4.0662844  4.1853367
## [115]  4.4170927  4.5298461  4.6405712  4.7493074  4.8561088  4.9610261
## [121]  5.0127900  5.0640990  5.1653609  5.2648436  5.3625902  5.4586346
## [127]  5.5529997  5.6457097  5.7367767  5.8262163  5.9140329  6.0002406
## [133]  6.0848397  6.1678365  6.2492409  6.3290463  6.4072349  6.4837859
## [139]  6.6319101  6.7733356  6.9079253  7.0354559  7.2683888  7.4702753
## [145]  7.6394324  7.7749838  7.9506277  7.9990849  8.0298924  8.0498992
## [151]  8.0651195  8.0804571  8.0995138  8.1246074  8.1571601  8.1980377
## [157]  8.2477239  8.3064331  8.3742018  8.4509581  8.5365665  8.6308407
## [163]  8.7335586  8.9633063  9.2235945  9.5120416  9.8261846 10.1635309
## [169] 10.5215634 10.8977160 11.2894251 11.6940290 12.1086542 12.5301917
## [175] 13.3806883 14.2194470 15.0235590 15.7609024 16.3438806 16.5495043
## [181] 16.7055677 16.8254066 16.9198837 17.0602076 17.1614822 17.2401404
## [187] 17.3046010 17.3595142 17.4075158 17.4501098 17.4881937 17.5223569
## [193] 17.5530716 17.5808373 17.6062259 17.6297792 17.6518790 17.6727348
## [199] 17.6924404 17.7110416 17.7285831 17.7451385 17.7608150 17.7757472
## [205] 17.7900447 17.8037763 17.8169733 17.8296591 17.8418518 17.8535793
## [211] 17.8648844 17.8758038 17.8863635 17.8931463</code></pre>
<p>With a single species there is always one more time step than cohort introduction, with the last two steps having the same number of cohorts. With multiple species there can be more time steps than cohort introductions, as we’ll record data every cohort introduction for <em>either</em> species, which will be refined to different schedules.</p>
<p>Individual plants increase in height with respect to time, but because they are competing the growth rate depends on the amount of shading above them, in addition to size dependent growth rate (see vignette:plant)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">matplot</span>(t, h, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(<span class="st">"black"</span>, <span class="fl">0.25</span>), <span class="dt">type=</span><span class="st">"l"</span>,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">        <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-9-1.png"></p>
<p>The light environment is stored over each time step:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">xlim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">1.1</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">ylim &lt;-<span class="st"> </span><span class="kw">range</span>(data1<span class="op">$</span>light_env[[<span class="kw">length</span>(data1<span class="op">$</span>light_env)]][, <span class="st">"height"</span>])</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim=</span>xlim, <span class="dt">ylim=</span>ylim, <span class="dt">las=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">     <span class="dt">xlab=</span><span class="st">"Canopy openness"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="cf">for</span> (i <span class="cf">in</span> data1<span class="op">$</span>light_env) {</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="kw">lines</span>(i[, <span class="st">"canopy_openness"</span>], i[, <span class="st">"height"</span>], <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">blues &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#DEEBF7"</span>, <span class="st">"#C6DBEF"</span>, <span class="st">"#9ECAE1"</span>, <span class="st">"#6BAED6"</span>,</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">           <span class="st">"#4292C6"</span>, <span class="st">"#2171B5"</span>, <span class="st">"#08519C"</span>, <span class="st">"#08306B"</span>)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">times &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>, data1<span class="op">$</span>time[[<span class="kw">length</span>(data1<span class="op">$</span>time)]])</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">cols &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(blues[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)])(<span class="kw">length</span>(times))</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(times)) {</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">  x &lt;-<span class="st"> </span>data1<span class="op">$</span>light_env[[<span class="kw">which.min</span>(<span class="kw">abs</span>(times[[i]] <span class="op">-</span><span class="st"> </span>data1<span class="op">$</span>time))]]</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">  <span class="kw">lines</span>(x[, <span class="st">"canopy_openness"</span>], x[, <span class="st">"height"</span>], <span class="dt">col=</span>cols[[i]])</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">  y &lt;-<span class="st"> </span>x[<span class="kw">nrow</span>(x), <span class="st">"height"</span>]</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">  <span class="kw">points</span>(<span class="dv">1</span>, y, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span>cols[[i]])</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">  <span class="kw">text</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">strwidth</span>(<span class="st">"x"</span>), y, <span class="kw">paste</span>(<span class="kw">round</span>(times[[i]]), <span class="st">"years"</span>),</a>
<a class="sourceLine" id="cb15-19" data-line-number="19">       <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb15-20" data-line-number="20">}</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-10-1.png"></p>
<p>The amount of light at the ground level is perhaps the most relevant metric:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">sapply</span>(data1<span class="op">$</span>light_env, <span class="cf">function</span>(x) x[<span class="dv">1</span>, <span class="st">"canopy_openness"</span>])</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">plot</span>(data1<span class="op">$</span>time, y, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">las=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">     <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Canopy openness"</span>)</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-11-1.png"></p>
<p>The waves here are due to rounds of recruitment and self thinning. Mortality is not instantaneous, so species recruit to a density that generates a canopy that they cannot survive under.</p>
<p>Leaf area index is the driver that controls the canopy openness (via the light extinction coefficient <code>p1$k_I</code>, following exponential extinction). This is not returned by <code>run_scm_collect</code> so instead we need to rebuild patches using <code>scm_patch</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">patches1 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(data1<span class="op">$</span>time), scm_patch, data1)</a></code></pre></div>
<p>Each element of the resulting list is a Patch object, the same as was observed when running the model.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">lai1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(patches1, <span class="cf">function</span>(x) x<span class="op">$</span><span class="kw">area_leaf_above</span>(<span class="fl">0.0</span>))</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">plot</span>(data1<span class="op">$</span>time, lai1, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">     <span class="dt">ylab=</span><span class="st">"Leaf area index"</span>)</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-13-1.png"></p>
<p>If multiple species are grown at once, they compete with one another. This adds a second species – with a higher lma value than the first species – to the population and runs them until they reach equilibrium seed rain at the metapopulation level.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">p2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_parameters.html">expand_parameters</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(<span class="fl">0.2625</span>, <span class="st">"lma"</span>), p1, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">p2_eq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equilibrium_seed_rain.html">equilibrium_seed_rain</a></span>(p2)</a></code></pre></div>
<p>Then collect the patch-level dynamics:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">data2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/run_scm_collect.html">run_scm_collect</a></span>(p2_eq)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">t2 &lt;-<span class="st"> </span>data2<span class="op">$</span>time</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">h1 &lt;-<span class="st"> </span>data2<span class="op">$</span>species[[<span class="dv">1</span>]][<span class="st">"height"</span>, , ]</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">h2 &lt;-<span class="st"> </span>data2<span class="op">$</span>species[[<span class="dv">2</span>]][<span class="st">"height"</span>, , ]</a>
<a class="sourceLine" id="cb20-6" data-line-number="6"></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"#e34a33"</span>, <span class="st">"#045a8d"</span>)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="kw">matplot</span>(t2, h1, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(cols[[<span class="dv">1</span>]], <span class="fl">.25</span>), <span class="dt">type=</span><span class="st">"l"</span>,</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">        <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="kw">matlines</span>(t2, h2, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(cols[[<span class="dv">2</span>]], <span class="fl">.25</span>))</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-15-1.png"></p>
<p>Alternatively we can compare the growth of species 1 by itself or with another species:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">matplot</span>(t, h, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(<span class="st">"black"</span>, <span class="fl">.25</span>), <span class="dt">type=</span><span class="st">"l"</span>,</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">        <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Height (m)"</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">matlines</span>(t2, h1, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(cols[[<span class="dv">1</span>]], <span class="fl">.25</span>))</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-16-1.png"></p>
<p>This shows that the additional species does not affect the growth of the <em>initial</em> wave of cohorts (because the second species is growing more slowly and is shorter than the first species), but subsequent waves are slowed or eliminated.</p>
<p>The dynamics are easier to see when coded by cohort density (some of the lines here represent cohorts at close to zero density).</p>
<p>Relativise the log densities onto (-4, max)</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">d1 &lt;-<span class="st"> </span>data2<span class="op">$</span>species[[<span class="dv">1</span>]][<span class="st">"log_density"</span>, , ]</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">d2 &lt;-<span class="st"> </span>data2<span class="op">$</span>species[[<span class="dv">2</span>]][<span class="st">"log_density"</span>, , ]</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">rel &lt;-<span class="st"> </span><span class="cf">function</span>(x, xmin) {</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  x[x <span class="op">&lt;</span><span class="st"> </span>xmin] &lt;-<span class="st"> </span>xmin</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">  xmax &lt;-<span class="st"> </span><span class="kw">max</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  (x <span class="op">-</span><span class="st"> </span>xmin) <span class="op">/</span><span class="st"> </span>(xmax <span class="op">-</span><span class="st"> </span>xmin)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">rd1 &lt;-<span class="st"> </span><span class="kw">rel</span>(d1, <span class="dv">-4</span>)</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">rd2 &lt;-<span class="st"> </span><span class="kw">rel</span>(d2, <span class="dv">-4</span>)</a></code></pre></div>
<p>R doesn’t seem to offer a way to plot lines that vary in colour, so this is quite roundabout using <code>segments</code>, shaded by the density at the first part of the line segment:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">length</span>(t2)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(t2, <span class="kw">ncol</span>(h1)), <span class="kw">nrow</span>(h1))</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">col1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(cols[[<span class="dv">1</span>]], rd1), <span class="kw">nrow</span>(d1))</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">col2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw"><a href="../reference/make_transparent.html">make_transparent</a></span>(cols[[<span class="dv">2</span>]], rd2), <span class="kw">nrow</span>(d2))</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim=</span><span class="kw">range</span>(t2), <span class="dt">ylim=</span><span class="kw">range</span>(h1, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Cohort height (m)"</span>)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="kw">segments</span>(x[<span class="op">-</span><span class="dv">1</span>, ], h2[<span class="op">-</span><span class="dv">1</span>, ], x[<span class="op">-</span>n, ], h2[<span class="op">-</span>n, ], <span class="dt">col=</span>col2[<span class="op">-</span>n, ], <span class="dt">lend=</span><span class="st">"butt"</span>)</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="kw">segments</span>(x[<span class="op">-</span><span class="dv">1</span>, ], h1[<span class="op">-</span><span class="dv">1</span>, ], x[<span class="op">-</span>n, ], h1[<span class="op">-</span>n, ], <span class="dt">col=</span>col1[<span class="op">-</span>n, ], <span class="dt">lend=</span><span class="st">"butt"</span>)</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-18-1.png"></p>
<p>Then, the total leaf area:</p>
<p>Each element of the resulting list is a Patch object, the same as was observed when running the model.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">patches2 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">seq_along</span>(data2<span class="op">$</span>time), scm_patch, data2)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">lai2 &lt;-<span class="st"> </span><span class="kw">sapply</span>(patches2, <span class="cf">function</span>(x) x<span class="op">$</span><span class="kw">area_leaf_above</span>(<span class="fl">0.0</span>))</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">lai2_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">sapply</span>(patches2, <span class="cf">function</span>(x) x<span class="op">$</span>species[[<span class="dv">1</span>]]<span class="op">$</span><span class="kw">area_leaf_above</span>(<span class="fl">0.0</span>))</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">lai2_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">sapply</span>(patches2, <span class="cf">function</span>(x) x<span class="op">$</span>species[[<span class="dv">2</span>]]<span class="op">$</span><span class="kw">area_leaf_above</span>(<span class="fl">0.0</span>))</a>
<a class="sourceLine" id="cb24-6" data-line-number="6"></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="kw">plot</span>(t2, lai2, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">     <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Leaf area index"</span>)</a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="kw">lines</span>(t2, lai2_<span class="dv">1</span>, <span class="dt">col=</span>cols[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="kw">lines</span>(t2, lai2_<span class="dv">2</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-19-1.png"></p>
<p>To find the average value over the metapopulation we weight by patch abundance:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">metapopulation &lt;-<span class="st"> </span><span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  plant<span class="op">:::</span><span class="kw">trapezium</span>(t2, x<span class="op">*</span>data2<span class="op">$</span>patch_density)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">lai2_av &lt;-<span class="st"> </span><span class="kw">metapopulation</span>(lai2)</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">lai2_<span class="dv">1</span>_av &lt;-<span class="st"> </span><span class="kw">metapopulation</span>(lai2_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">lai2_<span class="dv">2</span>_av &lt;-<span class="st"> </span><span class="kw">metapopulation</span>(lai2_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-8" data-line-number="8"></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="kw">plot</span>(t2, lai2, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">     <span class="dt">xlab=</span><span class="st">"Time (years)"</span>, <span class="dt">ylab=</span><span class="st">"Leaf area index"</span>)</a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="kw">lines</span>(t2, lai2_<span class="dv">1</span>, <span class="dt">col=</span>cols[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="kw">lines</span>(t2, lai2_<span class="dv">2</span>, <span class="dt">col=</span>cols[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb25-13" data-line-number="13"></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="kw">axis</span>(<span class="dv">4</span>, <span class="dt">at=</span>lai2_av,   <span class="dt">tck=</span><span class="fl">0.1</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">labels=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="kw">axis</span>(<span class="dv">4</span>, <span class="dt">at=</span>lai2_<span class="dv">1</span>_av, <span class="dt">tck=</span><span class="fl">0.1</span>, <span class="dt">col.ticks=</span>cols[[<span class="dv">1</span>]], <span class="dt">labels=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="kw">axis</span>(<span class="dv">4</span>, <span class="dt">at=</span>lai2_<span class="dv">2</span>_av, <span class="dt">tck=</span><span class="fl">0.1</span>, <span class="dt">col.ticks=</span>cols[[<span class="dv">1</span>]], <span class="dt">labels=</span><span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="dv">108</span>, <span class="dt">labels=</span><span class="st">"Av"</span>)</a></code></pre></div>
<p><img src="figure/patch__unnamed-chunk-20-1.png"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
