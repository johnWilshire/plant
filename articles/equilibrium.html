<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>plant: A package for modelling forest trait ecology &amp; evolution: <em>Finding demographic equilibrium</em> • plant</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">plant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/plant.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cohort_spacing.html">plant: A package for modelling forest trait ecology &amp; evolution: _Cohort spacing algorithm_</a>
    </li>
    <li>
      <a href="../articles/developer_notes.html">Developer Notes</a>
    </li>
    <li>
      <a href="../articles/emergent.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level emergent properties_</a>
    </li>
    <li>
      <a href="../articles/equilibrium.html">plant: A package for modelling forest trait ecology &amp; evolution: _Finding demographic equilibrium_</a>
    </li>
    <li>
      <a href="../articles/fitness.html">plant: A package for modelling forest trait ecology &amp; evolution: _Calculating fitness_</a>
    </li>
    <li>
      <a href="../articles/parameters.html">plant: A package for modelling forest trait ecology &amp; evolution: _Modifying parameters_</a>
    </li>
    <li>
      <a href="../articles/patch.html">plant: A package for modelling forest trait ecology &amp; evolution: _Patch-level dynamics_</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>plant: A package for modelling forest trait ecology &amp; evolution: <em>Finding demographic equilibrium</em>
</h1>
            
            <h4 class="date">2018-01-04</h4>
          </div>

    
    
<div class="contents">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(plant)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(parallel)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">run &lt;-<span class="st"> </span><span class="cf">function</span>(seed_rain_in, p) {</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  p<span class="op">$</span>seed_rain &lt;-<span class="st"> </span>seed_rain_in</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="kw"><a href="../reference/run_scm.html">run_scm</a></span>(p)<span class="op">$</span>seed_rains</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">run_new_schedule &lt;-<span class="st"> </span><span class="cf">function</span>(seed_rain_in, p) {</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  p<span class="op">$</span>seed_rain &lt;-<span class="st"> </span>seed_rain_in</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/build_schedule.html">build_schedule</a></span>(p)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  <span class="kw">attr</span>(res, <span class="st">"seed_rain_out"</span>)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">cobweb &lt;-<span class="st"> </span><span class="cf">function</span>(m, ...) {</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  <span class="kw">lines</span>(<span class="kw">rep</span>(m[,<span class="dv">1</span>], <span class="dt">each=</span><span class="dv">2</span>), <span class="kw">c</span>(<span class="kw">t</span>(m)), ...)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">}</a></code></pre></div>
<p>Try to establish what the equilibrium seed rain is.</p>
<p>Set model parameters</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">p0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/scm_base_parameters.html">scm_base_parameters</a></span>(<span class="st">"FF16"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_parameters.html">expand_parameters</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(<span class="fl">0.0825</span>, <span class="st">"lma"</span>), p0, <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Some output seed rains, given an input seed rain:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">run</span>(<span class="fl">1.0</span>, p)</a></code></pre></div>
<pre><code>## [1] 19.82443</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">run</span>(<span class="fl">10.0</span>, p)</a></code></pre></div>
<pre><code>## [1] 17.63104</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">run</span>(<span class="fl">50.0</span>, p)</a></code></pre></div>
<pre><code>## [1] 16.58796</code></pre>
<p>When below the equilibrium, <code>run</code> returns a seed rain that is greater than the input, when above it, <code>run</code> returns a seed rain that is less than the input.</p>
<section id="approach-to-equilibrium" class="level1"><h1>1: Approach to equilibrium:</h1>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">p_eq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equilibrium_seed_rain.html">equilibrium_seed_rain</a></span>(p)</a></code></pre></div>
<p>Equilibrium seed rain is right around where the last two values from run were producing</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">p_eq<span class="op">$</span>seed_rain</a></code></pre></div>
<pre><code>## [1] 17.31512</code></pre>
<p>From a distance, these both hone in nicely on the equilibrium, and rapidly, too.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">approach &lt;-<span class="st"> </span><span class="kw">attr</span>(p_eq, <span class="st">"progress"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">r &lt;-<span class="st"> </span><span class="kw">range</span>(approach)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">plot</span>(approach, <span class="dt">type=</span><span class="st">"n"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlim=</span>r, <span class="dt">ylim=</span>r)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">cobweb</span>(approach, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span>.<span class="dv">5</span>, <span class="dt">type=</span><span class="st">"o"</span>)</a></code></pre></div>
<p><img src="figure/equilibrium__equilibrium_approach-1.png"></p>
</section><section id="near-the-equilibrium-point" class="level1"><h1>2: Near the equilibrium point:</h1>
<p>Then, in the vicinity of the root we should look at what the curve actually looks like, without adaptive refinement.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">dr &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co"># range of input to vary (plus and minus this many seeds)</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">seed_rain_in &lt;-<span class="st"> </span><span class="kw">seq</span>(p_eq<span class="op">$</span>seed_rain <span class="op">-</span><span class="st"> </span>dr,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                    p_eq<span class="op">$</span>seed_rain <span class="op">+</span><span class="st"> </span>dr, <span class="dt">length.out=</span><span class="dv">31</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">seed_rain_out &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/mclapply">mclapply</a></span>(seed_rain_in, run, p_eq))</a></code></pre></div>
<p>Here is input seeds vs. output seeds:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">plot</span>(seed_rain_in, seed_rain_out, <span class="dt">xlab=</span><span class="st">"Incoming seed rain"</span>,</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">     <span class="dt">ylab=</span><span class="st">"Outgoing seed rain"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">asp=</span><span class="dv">5</span>, <span class="dt">col=</span><span class="st">"red"</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">cobweb</span>(approach)</a></code></pre></div>
<p><img src="figure/equilibrium__seeds_in_seeds_out-1.png"></p>
</section><section id="global-function-shape" class="level1"><h1>4. Global function shape</h1>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">seed_rain_in_global &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">max</span>(approach), <span class="dt">length.out=</span><span class="dv">51</span>)</a></code></pre></div>
<p>This takes quite a while to compute.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">seed_rain_out_global &lt;-</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">unlist</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/mclapply">mclapply</a></span>(seed_rain_in_global, run_new_schedule, p))</a></code></pre></div>
<p>This is pretty patchy, which is due to incompletely refining the cohort schedule, I believe. Tighten <code>schedule_eps</code> to make the curve smoother, at the cost of potentially a lot more effort.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">plot</span>(seed_rain_in_global, seed_rain_out_global,</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">     <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">type=</span><span class="st">"l"</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">     <span class="dt">xlab=</span><span class="st">"Incoming seed rain"</span>, <span class="dt">ylab=</span><span class="st">"Outgoing seed rain"</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw">cobweb</span>(approach, <span class="dt">lty=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="figure/equilibrium__seeds_in_seeds_out_global-1.png"></p>
</section><section id="multiple-species-at-once" class="level1"><h1>5. Multiple species at once:</h1>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">lma &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.0825</span>, <span class="fl">0.15</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">p2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand_parameters.html">expand_parameters</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(lma, <span class="st">"lma"</span>), p0, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">p2_eq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equilibrium_seed_rain.html">equilibrium_seed_rain</a></span>(p2)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">approach &lt;-<span class="st"> </span><span class="kw">attr</span>(p2_eq, <span class="st">"progress"</span>)</a></code></pre></div>
<p>From a distance, these both hone in nicely on the equilibrium, and rapidly, too.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">r &lt;-<span class="st"> </span><span class="kw">range</span>(<span class="kw">unlist</span>(approach))</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">plot</span>(approach[[<span class="dv">1</span>]], <span class="dt">type=</span><span class="st">"n"</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">xlim=</span>r, <span class="dt">ylim=</span>r, <span class="dt">xlab=</span><span class="st">"in"</span>, <span class="dt">ylab=</span><span class="st">"out"</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"grey"</span>)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="kw">cobweb</span>(approach[, i <span class="op">+</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)], <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span>.<span class="dv">5</span>, <span class="dt">type=</span><span class="st">"o"</span>, <span class="dt">col=</span>cols[[i]])</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="kw">abline</span>(<span class="dt">v=</span>p2_eq<span class="op">$</span>seed_rain, <span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">lty=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="figure/equilibrium__approach_two_species-1.png"></p>
<p>Note that the first guess position of the red species is higher than the black species, but in the end the output seed rain is lower. This is the difficulty in computing multi species equilibria - the different solutions affect each other. In general multi-dimensional root finding is difficult; even knowing that there are roots is not straightforward, much less proving that we’ve converged on the “correct” root (for example [0,0] is a root in this case but that root is not stable). plant uses some heuristics to try to ensure that the root returned is an attracting point but sequentially applying rounds of iteration and non-linear root finding algorithms, as well as rescaling seed rains to repel from known unstable roots.</p>
<p>To illustrate this a little further, though still in the fairly trivial 2d case, first identify the other two equilibria.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">pp &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/mclapply">mclapply</a></span>(lma, <span class="cf">function</span>(x)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  <span class="kw"><a href="../reference/equilibrium_seed_rain.html">equilibrium_seed_rain</a></span>(<span class="kw"><a href="../reference/expand_parameters.html">expand_parameters</a></span>(<span class="kw"><a href="../reference/trait_matrix.html">trait_matrix</a></span>(x, <span class="st">"lma"</span>), p0, <span class="ot">FALSE</span>)))</a></code></pre></div>
<p>Here’s the seed rains of each species when alone:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">seed_rain1 &lt;-<span class="st"> </span><span class="kw">sapply</span>(pp, <span class="cf">function</span>(x) x<span class="op">$</span>seed_rain)</a></code></pre></div>
<p>So that means that we have <em>four</em> equilibria: 1: The trivial equilibrium:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">eq00 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">run</span>(eq00, p2_eq) <span class="op">-</span><span class="st"> </span>eq00</a></code></pre></div>
<pre><code>## [1] 0 0</code></pre>
<p>2: Species 1 alone</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">eq10 &lt;-<span class="st"> </span><span class="kw">c</span>(seed_rain1[[<span class="dv">1</span>]], <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw">run_new_schedule</span>(eq10, p2) <span class="op">-</span><span class="st"> </span>eq10</a></code></pre></div>
<pre><code>## [1] -0.009399603  0.000000000</code></pre>
<p>3: Species 2 alone</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">eq01 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, seed_rain1[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="kw">run_new_schedule</span>(eq01, p2) <span class="op">-</span><span class="st"> </span>eq01</a></code></pre></div>
<pre><code>## [1] 0.000000000 0.007976816</code></pre>
<p>4: Species 1 and 2 together:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">eq11 &lt;-<span class="st"> </span>p2_eq<span class="op">$</span>seed_rain</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw">run</span>(eq11, p2_eq) <span class="op">-</span><span class="st"> </span>eq11</a></code></pre></div>
<pre><code>## [1] 0.0011239196 0.0003123585</code></pre>
<p>(note that the approximations here mean that these equilibria are not terribly well polished - there are a set of nested approximations that make this difficult. Possibly the biggest culprit is the cohort refinement step).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">len &lt;-<span class="st"> </span><span class="dv">21</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">dx &lt;-<span class="st"> </span><span class="kw">max</span>(seed_rain1) <span class="op">/</span><span class="st"> </span>(len <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">n1 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dt">by=</span>dx, <span class="dt">to=</span>seed_rain1[[<span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span>dx)</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">n2 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dt">by=</span>dx, <span class="dt">to=</span>seed_rain1[[<span class="dv">2</span>]] <span class="op">+</span><span class="st"> </span>dx)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">nn_in &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(n1, n2))</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">tmp &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/mclapply">mclapply</a></span>(<span class="kw">unname</span>(<span class="kw">split</span>(nn_in, <span class="kw">seq_len</span>(<span class="kw">nrow</span>(nn_in)))),</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">                run_new_schedule, p2_eq)</a>
<a class="sourceLine" id="cb30-8" data-line-number="8">nn_out &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">"rbind"</span>, tmp)</a>
<a class="sourceLine" id="cb30-9" data-line-number="9"></a>
<a class="sourceLine" id="cb30-10" data-line-number="10">len &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="kw">rowSums</span>(<span class="kw">sqrt</span>((nn_out <span class="op">-</span><span class="st"> </span>nn_in)<span class="op">^</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">rlen &lt;-<span class="st"> </span>len <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(len) <span class="op">*</span><span class="st"> </span>dx <span class="op">*</span><span class="st"> </span><span class="fl">0.8</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"></a>
<a class="sourceLine" id="cb30-13" data-line-number="13">theta &lt;-<span class="st"> </span><span class="kw">atan2</span>(nn_out[, <span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>nn_in[, <span class="dv">2</span>], nn_out[, <span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>nn_in[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb30-14" data-line-number="14"></a>
<a class="sourceLine" id="cb30-15" data-line-number="15">x1 &lt;-<span class="st"> </span>nn_in[, <span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>rlen <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(theta)</a>
<a class="sourceLine" id="cb30-16" data-line-number="16">y1 &lt;-<span class="st"> </span>nn_in[, <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>rlen <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(theta)</a></code></pre></div>
<p>NOTE: I’m not sure why the point really close to the equilibrium here looks like it’s moving so quickly, and possibly in the wrong direction. Cohort instability perhaps?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">plot</span>(nn_in, <span class="dt">xlab=</span><span class="st">"Species 1"</span>, <span class="dt">ylab=</span><span class="st">"Species 2"</span>, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span>.<span class="dv">25</span>,</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">     <span class="dt">col=</span><span class="st">"grey"</span>, <span class="dt">asp=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw">arrows</span>(nn_in[, <span class="dv">1</span>], nn_in[, <span class="dv">2</span>], x1, y1, <span class="dt">length=</span><span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="kw">lines</span>(<span class="kw">rbind</span>(approach[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], approach[, <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]), <span class="dt">type=</span><span class="st">"o"</span>, <span class="dt">col=</span><span class="st">"red"</span>,</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">      <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">cex=</span>.<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="kw">points</span>(p2_eq<span class="op">$</span>seed_rain[[<span class="dv">1</span>]], p2_eq<span class="op">$</span>seed_rain[[<span class="dv">2</span>]], <span class="dt">pch=</span><span class="dv">19</span>)</a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="kw">points</span>(<span class="kw">rbind</span>(eq00, eq10, eq01))</a></code></pre></div>
<p><img src="figure/equilibrium__unnamed-chunk-17-1.png"></p>
</section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#approach-to-equilibrium">1: Approach to equilibrium:</a></li>
      <li><a href="#near-the-equilibrium-point">2: Near the equilibrium point:</a></li>
      <li><a href="#global-function-shape">4. Global function shape</a></li>
      <li><a href="#multiple-species-at-once">5. Multiple species at once:</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Falster, Richard FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
